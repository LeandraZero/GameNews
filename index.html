<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>用增游戏行业双周报</title>

  <!-- Swiper CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css">
  <!-- Google Fonts - Inter & Noto Sans SC -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #05070a;
      --card-bg: rgba(23, 28, 41, 0.7);
      --accent: #4f6ef7;
      --accent-glow: rgba(79, 110, 247, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --glass-border: rgba(255, 255, 255, 0.08);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      --radius: 28px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0;
      background-color: var(--bg);
      background-image:
        radial-gradient(circle at 10% 20%, rgba(79, 110, 247, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 40%);
      color: var(--text-primary);
      font-family: 'Inter', 'Noto Sans SC', system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    header {
      padding: 40px 24px 20px;
      max-width: 1100px;
      margin: 0 auto;
      width: 100%;
      text-align: center;
    }

    .title {
      font-size: 28px;
      font-weight: 900;
      letter-spacing: -0.5px;
      background: linear-gradient(to right, #fff, #94a3b8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
    }

    .hint { color: var(--text-secondary); font-size: 14px; opacity: .8; }

    /* toolbar 两行 */
    .toolbar { margin-top: 18px; display: flex; flex-direction: column; align-items: center; gap: 12px; }
    .toolbar-row { width: min(820px, 92vw); display:flex; justify-content:center; align-items:center; gap:12px; flex-wrap:wrap; }

    .search{
      display:flex; align-items:center; gap:10px; width:100%;
      padding:10px 12px; border-radius:16px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
    }
    .search input{ flex:1; background:transparent; border:none; outline:none; color:var(--text-primary); font-size:14px; }
    .search input::placeholder{ color: rgba(148,163,184,.85); }

    .clear-btn{
      background: rgba(255,255,255,.06);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
      padding: 8px 12px;
      border-radius: 12px;
      cursor: pointer;
      white-space: nowrap;
    }

    .toc-wrap{ position:relative; }
    .toc-btn{
      height:44px; padding:0 14px; border-radius:14px;
      background: rgba(255,255,255,.04);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
      cursor:pointer;
      white-space: nowrap;
    }
    .toc-panel{
      position:absolute; right:0; top:52px;
      width:min(380px, 92vw);
      max-height: 60vh; overflow:auto;
      padding: 14px; border-radius: 18px;
      background: rgba(15,23,42,.92);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-lg);
      display:none; z-index:50; text-align:left;
    }
    .toc-panel.open{ display:block; }
    .toc-title{ font-weight:800; color:#a5b4fc; margin-bottom:10px; }

    .toc-item{
      padding:10px 10px; border-radius:14px; cursor:pointer;
      border:1px solid transparent;
    }
    .toc-item:hover{ background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.08); }

    .toc-item .toc-tag{
      display:inline-block; font-size:11px; color:#a5b4fc; margin-right:8px; opacity:.9;
      flex:0 0 auto;
    }

    .toc-row{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .toc-left{ min-width:0; flex:1 1 auto; }
    .toc-time{ flex:0 0 auto; font-size:11px; color: rgba(148,163,184,.85); margin-top:1px; white-space:nowrap; }
    .toc-text{
      display:block; color:#eaf0ff; font-size:13px; line-height:1.35; margin-top:2px;
      overflow:hidden; text-overflow:ellipsis;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
    }
    .toc-empty{ color: rgba(148,163,184,.9); font-size:13px; padding:8px 4px; }

    /* 竖向滑动开关 */
    .switch{
      height:44px; display:inline-flex; align-items:center; gap:10px;
      padding:0 14px; border-radius:14px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--glass-border);
      cursor:pointer; user-select:none; white-space:nowrap;
    }
    .switch input{ display:none; }
    .switch .dot{
      width:34px; height:20px; border-radius:999px;
      background: rgba(255,255,255,.10);
      position:relative; border:1px solid rgba(255,255,255,.10);
    }
    .switch .dot::after{
      content:""; position:absolute; width:14px; height:14px; border-radius:50%;
      top:50%; left:3px; transform: translateY(-50%);
      background: rgba(255,255,255,.85);
      transition: all .2s ease;
    }
    .switch input:checked + .dot{ background: rgba(79,110,247,.25); border-color: rgba(79,110,247,.35); }
    .switch input:checked + .dot::after{ left:17px; background:#a5b4fc; }
    .switch span{ font-size:13px; color:#eaf0ff; opacity:.92; }

    .wrap{
      flex:1; width:100%; max-width:1200px;
      margin:0 auto; padding:0 20px 60px;
      display:flex; align-items:center;
    }

    .swiper{
      width:100%;
      padding:20px 0 60px;
      overflow: visible !important;
      position:relative;
    }

    /* 竖向模式：需要明确高度 */
    body.is-vertical .wrap{ align-items:flex-start; }
    body.is-vertical .swiper{
      height:min(820px, 78vh);
      padding:18px 0;
    }

    .swiper-slide{
      width:auto;
      display:flex;
      justify-content:center;
      transition: transform .4s cubic-bezier(.2,.8,.2,1);
    }

    .flip{
      width:min(90vw, 420px);
      height:min(70vh, 600px);
      perspective:2000px;
    }
    body.is-vertical .flip{ height:100%; width:min(92vw, 440px); }
    body.is-vertical .swiper-slide{ height:100%; display:flex; align-items:stretch; }

    .flip-inner{
      position:relative; width:100%; height:100%;
      transform-style:preserve-3d;
      transition: transform .7s cubic-bezier(.4,0,.2,1);
    }
    .flip.is-flipped .flip-inner{ transform: rotateY(180deg); }

    .card{
      position:absolute; inset:0;
      border-radius: var(--radius);
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-lg);
      overflow:hidden;
      backface-visibility:hidden;
      display:flex; flex-direction:column;
    }

    .front{ position:relative; padding:32px; padding-bottom:96px; }
    .meta{ display:flex; align-items:center; gap:12px; margin-bottom:20px; }

    .tag{
      padding:6px 14px; border-radius:100px;
      background: var(--accent-glow);
      border:1px solid rgba(79,110,247,.3);
      color:#a5b4fc;
      font-size:12px; font-weight:700;
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    .time{ color: var(--text-secondary); font-size:12px; font-weight:500; }

    .headline{
      font-size: clamp(22px, 5vw, 28px);
      font-weight:800; line-height:1.3;
      margin-bottom:16px;
      color: var(--text-primary);
    }
    .summary{
      color:#cbd5e1;
      font-size:16px; line-height:1.6;
      margin-bottom:24px;
      display:-webkit-box;
      -webkit-line-clamp:6;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .cover{
      display:flex; align-items:center; justify-content:center;
      background:#0f172a;
      position:relative;
      border-radius:18px;
      overflow:hidden;
      flex:1;
      min-height:200px;
    }
    .cover img{ width:100%; height:100%; object-fit:contain; object-position:center; }
    .cover::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(to top, rgba(5,7,10,.65), rgba(5,7,10,0) 60%);
      pointer-events:none;
    }

    .front-footer{
      position:absolute; left:24px; bottom:24px;
      display:flex; gap:12px;
    }

    .btn{
      background: var(--text-primary);
      color: var(--bg);
      border:none;
      padding:12px 24px;
      border-radius:14px;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      transition: all .3s ease;
      box-shadow: 0 4px 12px rgba(255,255,255,.1);
    }
    .btn:hover{
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255,255,255,.2);
    }

    .btn-secondary{
      background: rgba(255,255,255,.05);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
    }

    .back{
      transform: rotateY(180deg);
      padding:32px;
      background:#0f172a;
    }
    .back h2{
      font-size:20px; font-weight:800;
      margin:0 0 20px 0;
      color: var(--accent);
    }
    .detail{
      flex:1;
      color:#94a3b8;
      font-size:15px;
      line-height:1.7;
      overflow-y:auto;
      padding-right:10px;
      white-space:pre-wrap;
    }
    .detail::-webkit-scrollbar{ width:4px; }
    .detail::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.1); border-radius:10px; }

    .back-footer{ margin-top:24px; display:flex; gap:12px; }
    .link-btn{
      flex:1; text-align:center; text-decoration:none;
      background: var(--accent);
      color:white;
      padding:12px;
      border-radius:14px;
      font-weight:700;
      font-size:14px;
    }

    .swiper-pagination-bullet{
      background: var(--text-secondary);
      opacity:.2;
      width:10px; height:10px;
      margin:0 6px !important;
    }
    .swiper-pagination-bullet-active{
      background: var(--accent);
      opacity:1;
      width:24px;
      border-radius:5px;
    }

    /* 竖向模式：分页点右侧竖排 */
    body.is-vertical .swiper-pagination{
      position:absolute;
      right:18px; left:auto;
      top:50%; bottom:auto;
      transform: translateY(-50%);
      width:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    body.is-vertical .swiper-pagination-bullet{ margin:0 !important; }

    /* =========================
       右侧悬浮导航按钮
       ========================= */
    .nav-btn{
      position:absolute;
      z-index:20;
      width:44px; height:44px;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.04);
      border:1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      color:#eaf0ff;
      cursor:pointer;
      transition: all .25s ease;
      user-select:none;
      padding:0;
    }
    .nav-btn:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(79,110,247,.35);
      color:#a5b4fc;
      transform: translateY(-1px);
    }
    .nav-btn:focus-visible{
      outline: 2px solid rgba(79,110,247,.55);
      outline-offset:3px;
    }

    /* ✅ 竖向模式隐藏按钮 */
    body.is-vertical .nav-btn{ display:none !important; }
    body.is-vertical .swiper{ padding-right: 0; }

    /* 桌面端：按钮贴右侧，竖排居中（横向模式用） */
    @media (min-width: 769px) {
      .swiper { padding-right: 92px; } /* 给右侧按钮留安全区 */
      .swiper-button-prev,
      .swiper-button-next{
        left:auto !important;
        right:16px !important;
        transform:none !important;
      }
      .swiper-button-prev{ top: calc(50% - 34px) !important; }
      .swiper-button-next{ top: calc(50% + 34px) !important; }
    }

    /* 横向模式：非当前卡片虚焦 */
    body:not(.is-vertical) .swiper-slide .flip{
      transition: filter .25s ease, opacity .25s ease, transform .25s ease;
    }
    body:not(.is-vertical) .swiper-slide:not(.swiper-slide-active) .flip{
      filter: blur(2.6px);
      opacity:.45;
      transform: scale(.965);
    }
    body:not(.is-vertical) .swiper-slide-active .flip{
      filter:none;
      opacity:1;
      transform: scale(1);
    }

    /* 移动端：隐藏导航按钮 */
    @media (max-width: 768px) {
      header { padding: 30px 20px 10px; }
      .title { font-size: 24px; }
      .nav-btn { display: none; }
      .front { padding: 24px; }
    }


    /* ✅ 彻底禁用 Swiper 默认的所有图标内容 */
    .swiper-button-prev::after,
    .swiper-button-next::after {
      display: none !important;
      content: none !important;
    }

    /* ✅ 统一设置自定义箭头的基本样式 (只使用 ::before) */
    .nav-btn.swiper-button-prev::before,
    .nav-btn.swiper-button-next::before {
      content: "";
      display: block;
      width: 16px;
      height: 16px;
      border-right: 3px solid currentColor;
      border-bottom: 3px solid currentColor;
      transform-origin: center;
      transition: all 0.2s ease;
    }

    /* ✅ 分别设置左右箭头的旋转角度 */
    .nav-btn.swiper-button-prev::before {
      transform: rotate(135deg) scale(0.8);
    }

    .nav-btn.swiper-button-next::before {
      transform: rotate(-45deg) scale(0.8);
    }

    /* ✅ 兜底清理：确保没有其他元素干扰 */
    .swiper-button-prev,
    .swiper-button-next {
      font-size: 0 !important;
      line-height: 0 !important;
      text-indent: -9999px !important;
    }

  </style>
</head>

<body>
  <header>
    <div class="title">每周游戏资讯</div>
    <div class="hint" id="hintText">滑动切换卡片 · 点击查看更多内容</div>

    <div class="toolbar">
      <div class="toolbar-row">
        <div class="search">
          <input id="searchInput" type="search" placeholder="搜索标题 / 标签 / 关键词…" />
          <button id="clearBtn" class="clear-btn" type="button">清空</button>
        </div>
      </div>

      <div class="toolbar-row">
        <div class="toc-wrap">
          <button id="tocToggle" class="toc-btn" type="button">目录</button>
          <div id="tocPanel" class="toc-panel">
            <div class="toc-title">目录</div>
            <div id="tocList" class="toc-list"></div>
          </div>
        </div>

        <label class="switch" for="dirToggle" title="切换横向/竖向滑动">
          <input id="dirToggle" type="checkbox" />
          <span class="dot"></span>
          <span>竖向滑动</span>
        </label>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="swiper">
      <div class="swiper-wrapper" id="slides"></div>
      <div class="swiper-pagination"></div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js"></script>
  <script>
    const reports = [
      {
        tag: "竞品宣发",
        time: "2026-01",
        title: "《明日方舟：终末地》全球公测首日PayPal事故放大负面舆情",
        summary:
          "鹰角用近四年的宣发节奏（概念PV→多轮测试→国际展会节点→Apple Event→公测前瞻/预下载→1月22日全球公测）叠加大陆与海外线上线下投放，提前建立全球认知基础与首发声量；但公测首日PayPal被盗刷/异常扣款争议集中爆发，官方禁用PayPal并审查交易、对受影响订单全额退款，负面舆情被高期待放大。",
        detail: `当产品期待和影响力被拉高时，任何基础设施层面的失误都会被成倍放大。未来新游进入全球同步发行阶段，支付与账户安全等“非内容模块”需要被视为首发体验的一部分，甚至应优先于商业化规模扩张进行验证，避免在声量最高的窗口期消耗用户信任。`,
        source: "#https://km.mihoyo.com/doc/mhiekf0jsqy8",
        cover: "images/endfield.png",
      },

{
        tag: "行业信息",
        time: "2026-01",
        title: "法国禁止15岁以下未成年人使用社交媒体平台，最快下一个学年实施",
        summary:
          "2026年1月，法国国民议会通过法案方向，拟禁止15岁以下未成年人使用社交媒体平台，并推动加速立法，最快将于下一个学年正式实施。预计会对未来未成年人宣发造成阻力；这是继澳大利亚之后第二个采取此类措施的国家，同时巴西等国也在同步推进类似立法。",
        detail: `未成年人相关的监管正在加速外溢到更多国家。对宣发而言，影响不是“某一条政策”，而是长期趋势：面向未成年人的触达和表达空间会越来越窄，需要提前预案“投放/内容/渠道”在不同市场的合规边界。`,
        source: "#https://km.mihoyo.com/doc/mhiekf0jsqy8",
        cover: "images/France15.png",
      },

      
      {
        tag: "行业研究",
        time: "2026-01",
        title: "ST报告：ChatGPT 现已成为美国男性最受欢迎的十大应用之一",
        summary:
          "ST报告指出：2025年生成式AI逐渐成为移动设备生态的关键组成部分；非游戏应用的收入首次超过游戏应用收入，主要由ChatGPT、社交媒体、视频流媒体与生产力工具等带动；移动游戏需要与更多App争夺用户时间。",
        detail: `注意力经济横跨多个领域：如今，游戏需要与社交媒体、短剧和人工智能应用争夺用户时间。吸引用户注意力是实现盈利、提高用户留存率和实现长期增长的最有效途径。`,
        source: "#https://sensortower.com/report/state-of-mobile-2026/download",
        cover: "images/ST2026.png",
      },


      {
        tag: "行业信息",
        time: "2026-01",
        title: "2026年首批游戏版号发布：进口版号含腾讯《彩虹六号：攻势》、金山世游《愤怒的小鸟》系列等",
        summary:
          "2026年首批版号公布，进口版号包括腾讯《彩虹六号：攻势》、金山世游《愤怒的小鸟：经典归来》《愤怒的小鸟：梦幻爆破》等过审；从近一年每月版号下发数量来看，国产版号获批数量呈间断性增长，本月177个为近一年次高。",
        detail: `版号节奏仍是影响产品排期与宣发节点的关键变量，尤其在“窗口期竞争”更激烈的年份，越需要把内容节奏与宣发节点做成可伸缩模块，避免被动重排造成资源浪费。`,
        source: "#https://www.nppa.gov.cn/bsfw/jggs/yxspjg/gcwlyxspxx/202601/t20260126_947903.html",
        cover: "images/2026game.png",
      },

      {
        tag: "UGC相关",
        time: "2026-01",
        title: "Bruno Mars在《Roblox》UGC游戏中的虚拟演出最高吸引1280万同时在线用户",
        summary:
          "该演出在14个国家同步直播，直播观看人数约1000万；活动期间共发放542万件定制brainrot收藏品，并在社交平台上累计产生5300万次视频观看。",
        detail: `虚拟演出对 Roblox 和 Fortnite 这种产品的价值是同时在做拉新召回、破圈和商业化。它的超高同时在线用户人数也可以证明平台服务器可以支持大规模同步事件；演出内容又会被用户录屏二创扩散到各个社交平台，破圈传播；同时通过皮肤、道具、收藏品和品牌合作，把热度直接转成收入。`,
        source: "#https://www.musicbusinessworldwide.com/bruno-mars-pulls-record-12-8m-concurrent-users-to-roblox-concert/",
        cover: "images/mars.png",
      },

      {
        tag: "UGC相关",
        time: "2026-01",
        title: "Fortnite开放第三方创作者内购后，UGC游戏上线高价礼包与类赌博转盘引争议，Epic紧急收紧规则",
        summary:
          "Fortnite在2026年初正式开放第三方创作者内购后，头部UGC项目《Steal the Brainrot》迅速上线高价礼包（约45美元）与类赌博转盘机制，引发强烈不满；争议点包括上线不足24小时即引入高价随机礼包与概率转盘、以及“虚假折扣”等合规灰区。随后Epic紧急收紧规则，禁止付费影响抽奖结果。",
        detail: `无论是否引入创作者变现，在保证共创/UGC生态健康可循环的同时，也需要为规则快速迭代预留空间，避免生态在早期因激进或不合规设计透支品牌信用。`,
        source: "#https://km.mihoyo.com/doc/mhiekf0jsqy8",
        cover: "images/fornite.png",
      },

      {
        tag: "UGC相关",
        time: "2026-01",
        title: "R星推出官方MOD市场Cfx Marketplace，预示GTA6或有可能成为UGC平台型游戏",
        summary:
          "Rockstar近日推出官方MOD市场Cfx Marketplace，基于两大非官方平台FiveM和RedM构建；平台以“官方策展式数字商店”形态允许创作者分发并定价出售脚本、地图、道具等内容（部分免费、部分付费，价格可达数百美元），并为服务器管理员与玩家提供统一、安全的获取渠道；目前仍处于分阶段上线，首批创作者多为Rockstar参与共建的合作方。",
        detail: `如果UGC开始被官方“市场化”，它就不再只是内容生态，而会变成平台能力的一部分：统一分发、统一安全、统一交易。对平台型产品来说，这类基础设施的搭建，可能比单次爆款内容更能决定生态上限。`,
        source: "#https://km.mihoyo.com/doc/mhiekf0jsqy8",
        cover: "images/cfx.png",
      },

      {
        tag: "产品相关",
        time: "2026-01",
        title: "《Fable》创造1000+可结婚npc，强调全手搓非AI",
        summary:
          "1月22日Xbox Developer Direct上，Playground Games披露重启版《Fable》（非原先三部曲续作），确认2026年秋季登陆Xbox、PC及PS5。设计上强调“没有借用AI全靠手搓”，提出“Living Population”概念：超过1000名NPC拥有独立身份、作息与价值观，并会记住玩家行为形成不同评价；多平台同步发行也延续微软近年的去独占策略。",
        detail: `“Living Population”这种卖点的价值在于：它把长期体验的差异化写进系统里，而不是只靠叙事/包装。再叠加多平台同步发行，平台被弱化、内容被强化，最终拼的就是“游戏本身能不能提供持续被讨论与被记住的体验”。`,
        source: "#https://km.mihoyo.com/doc/mhiekf0jsqy8",
        cover: "images/fable.png",
      },

      {
        tag: "产品相关",
        time: "2026-01",
        title: "《无尽冬日》联动「影视飓风」：零下30℃、100小时雪地生存直播，把核心玩法映射到现实",
        summary:
          "《无尽冬日》与头部内容团队「影视飓风」联动，通过零下30℃、100小时不间断雪地生存直播引发超5万人在线观看。直播以“无物资开局 + AI画图换物资”的规则展开，对应游戏中“开局点火炉，步步攒资源”的核心玩法；不同于常规代言，这次把游戏系统拆解成可被创作者直接运用的挑战规则，形成破圈传播与玩法教学。",
        detail: `宣发不只是短视频种草或明星代言：把玩法映射到现实的真人直播能建立真实感、可信度，也有破圈潜力。对品牌方是一次放大的“玩法教学+IP叙事”，对创作者是可持续的内容规则，天然更容易双赢。`,
        source: "#https://km.mihoyo.com/doc/mhiekf0jsqy8",
        cover: "images/tim.png",
      },
    ];

    const container = document.getElementById('slides');
    const hintText = document.getElementById('hintText');
    const dirToggle = document.getElementById('dirToggle');

    let swiper;
    let currentList = [...reports];
    let isVertical = false;

    function setDirectionUI() {
      document.body.classList.toggle('is-vertical', isVertical);
      hintText.textContent = isVertical
        ? '上下滑动切换卡片 · 点击查看更多内容'
        : '左右滑动切换卡片 · 点击查看更多内容';
    }

    function resetFlips(){
      document.querySelectorAll('.flip.is-flipped')
        .forEach(el => el.classList.remove('is-flipped'));
    }

    function normalizeSource(s){
      if(!s) return "";
      // 兼容你写的 "#https://xxx"（否则会变成锚点链接）
      if (s.startsWith("#http")) return s.slice(1);
      if (s === "#") return "";
      // 你写 "#（未给出链接）" 这种也当作无链接
      if (s.startsWith("#（")) return "";
      return s;
    }

    function initSwiper() {
      if (swiper) swiper.destroy(true, true);

      swiper = new Swiper('.swiper', {
        direction: isVertical ? 'vertical' : 'horizontal',
        effect: 'slide',
        grabCursor: true,
        centeredSlides: true,
        slidesPerView: isVertical ? 1 : 'auto',
        spaceBetween: isVertical ? 20 : 30,

        mousewheel: isVertical ? { forceToAxis: true, releaseOnEdges: true } : false,
        pagination: { el: '.swiper-pagination', clickable: true },

        navigation: false,

        breakpoints: isVertical
          ? { 320: { spaceBetween: 16 }, 768: { spaceBetween: 20 } }
          : { 320: { spaceBetween: 20 }, 768: { spaceBetween: 40 } },

        slideToClickedSlide: true,
        watchSlidesProgress: true,

        on: { init() { this.update(); } }
      });

      swiper.update();
    }

    function renderSlides(list) {
      container.innerHTML = "";
      list.forEach((item, index) => {
        const slide = document.createElement('div');
        slide.className = 'swiper-slide';

        const sourceUrl = normalizeSource(item.source);
        const hasSource = !!sourceUrl;

        slide.innerHTML = `
          <div class="flip" id="card-${index}">
            <div class="flip-inner">
              <div class="card front">
                <div class="meta">
                  <span class="tag">${item.tag}</span>
                  <span class="time">${item.time}</span>
                </div>
                <div class="headline">${item.title}</div>
                <div class="summary">${item.summary}</div>

                <div class="cover">
                  ${item.cover ? `<img src="${item.cover}" alt="" loading="lazy">` : ""}
                </div>

                <div class="front-footer">
                  <button class="btn" onclick="toggleFlip(${index})">查看详情</button>
                </div>
              </div>

              <div class="card back">
                <h2>对我们的启示</h2>
                <div class="detail">${item.detail}</div>
                <div class="back-footer">
                  <button class="btn btn-secondary" onclick="toggleFlip(${index})">返回</button>
                  ${hasSource ? `<a href="${sourceUrl}" target="_blank" rel="noopener" class="link-btn">阅读原文</a>` : ''}
                </div>
              </div>
            </div>
          </div>
        `;
        container.appendChild(slide);
      });

      initSwiper();
    }

    function renderTOC(list) {
      const tocList = document.getElementById("tocList");
      if (!tocList) return;

      if (!list.length) {
        tocList.innerHTML = `<div class="toc-empty">没有匹配结果</div>`;
        return;
      }

      tocList.innerHTML = list.map((item, idx) => `
        <div class="toc-item" data-idx="${idx}">
          <div class="toc-row">
            <div class="toc-left">
              <span class="toc-tag">${item.tag}</span>
              <span class="toc-text">${item.title}</span>
            </div>
            <span class="toc-time">${item.time || ""}</span>
          </div>
        </div>
      `).join("");

      tocList.querySelectorAll(".toc-item").forEach(el => {
        el.addEventListener("click", () => {
          const i = Number(el.dataset.idx);
          swiper.slideTo(i, 500);
          closeTOC();
        });
      });
    }

    function normalizeText(s) {
      return (s ?? "").toString().toLowerCase();
    }

    function applyFilter() {
      const q = normalizeText(document.getElementById("searchInput")?.value).trim();
      if (!q) {
        currentList = [...reports];
      } else {
        currentList = reports.filter(item => {
          const hay = [item.tag, item.time, item.title, item.summary, item.detail]
            .map(normalizeText).join(" ");
          return hay.includes(q);
        });
      }
      resetFlips();
      renderSlides(currentList);
      renderTOC(currentList);
    }

    function toggleFlip(index) {
      const card = document.getElementById(`card-${index}`);
      if (card) card.classList.toggle('is-flipped');
    }
    window.toggleFlip = toggleFlip;

    /* 搜索框事件 */
    document.getElementById("searchInput")?.addEventListener("input", debounce(applyFilter, 120));
    document.getElementById("clearBtn")?.addEventListener("click", () => {
      const input = document.getElementById("searchInput");
      if (input) input.value = "";
      applyFilter();
    });

    /* 竖向开关事件 */
    dirToggle?.addEventListener("change", () => {
      isVertical = !!dirToggle.checked;
      resetFlips();
      setDirectionUI();
      initSwiper();
      swiper.slideTo(0, 0);
    });

    /* 目录开关 */
    const tocToggle = document.getElementById("tocToggle");
    const tocPanel = document.getElementById("tocPanel");
    function closeTOC(){ tocPanel?.classList.remove("open"); }
    tocToggle?.addEventListener("click", () => tocPanel?.classList.toggle("open"));
    document.addEventListener("click", (e) => {
      if (!tocPanel || !tocToggle) return;
      const target = e.target;
      if (tocPanel.contains(target) || tocToggle.contains(target)) return;
      closeTOC();
    });

    function debounce(fn, wait){
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), wait);
      };
    }

    /* 首次渲染 */
    setDirectionUI();
    renderSlides(currentList);
    renderTOC(currentList);
  </script>
</body>
</html>




